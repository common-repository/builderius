(()=>{"use strict";function t(t){return null!=t&&"object"==typeof t&&!0===t["@@functional/placeholder"]}function e(e){return function r(n){return 0===arguments.length||t(n)?r:e.apply(this,arguments)}}function r(r){return function n(a,i){switch(arguments.length){case 0:return n;case 1:return t(a)?n:e((function(t){return r(a,t)}));default:return t(a)&&t(i)?n:t(a)?e((function(t){return r(t,i)})):t(i)?e((function(t){return r(a,t)})):r(a,i)}}}const n=Array.isArray||function(t){return null!=t&&t.length>=0&&"[object Array]"===Object.prototype.toString.call(t)};function a(t){for(var e,r=[];!(e=t.next()).done;)r.push(e.value);return r}function i(t,e,r){for(var n=0,a=r.length;n<a;){if(t(e,r[n]))return!0;n+=1}return!1}function s(t,e){return Object.prototype.hasOwnProperty.call(e,t)}const o="function"==typeof Object.is?Object.is:function(t,e){return t===e?0!==t||1/t==1/e:t!=t&&e!=e};var c=Object.prototype.toString;const u=function(){return"[object Arguments]"===c.call(arguments)?function(t){return"[object Arguments]"===c.call(t)}:function(t){return s("callee",t)}}();var l=!{toString:null}.propertyIsEnumerable("toString"),h=["constructor","valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],d=function(){return arguments.propertyIsEnumerable("length")}(),p=function(t,e){for(var r=0;r<t.length;){if(t[r]===e)return!0;r+=1}return!1};const f="function"!=typeof Object.keys||d?e((function(t){if(Object(t)!==t)return[];var e,r,n=[],a=d&&u(t);for(e in t)!s(e,t)||a&&"length"===e||(n[n.length]=e);if(l)for(r=h.length-1;r>=0;)s(e=h[r],t)&&!p(n,e)&&(n[n.length]=e),r-=1;return n})):e((function(t){return Object(t)!==t?[]:Object.keys(t)}));const m=e((function(t){return null===t?"Null":void 0===t?"Undefined":Object.prototype.toString.call(t).slice(8,-1)}));function b(t,e,r,n){var s=a(t);function o(t,e){return g(t,e,r.slice(),n.slice())}return!i((function(t,e){return!i(o,e,t)}),a(e),s)}function g(t,e,r,n){if(o(t,e))return!0;var a,i,c=m(t);if(c!==m(e))return!1;if("function"==typeof t["fantasy-land/equals"]||"function"==typeof e["fantasy-land/equals"])return"function"==typeof t["fantasy-land/equals"]&&t["fantasy-land/equals"](e)&&"function"==typeof e["fantasy-land/equals"]&&e["fantasy-land/equals"](t);if("function"==typeof t.equals||"function"==typeof e.equals)return"function"==typeof t.equals&&t.equals(e)&&"function"==typeof e.equals&&e.equals(t);switch(c){case"Arguments":case"Array":case"Object":if("function"==typeof t.constructor&&"Promise"===(a=t.constructor,null==(i=String(a).match(/^function (\w*)/))?"":i[1]))return t===e;break;case"Boolean":case"Number":case"String":if(typeof t!=typeof e||!o(t.valueOf(),e.valueOf()))return!1;break;case"Date":if(!o(t.valueOf(),e.valueOf()))return!1;break;case"Error":return t.name===e.name&&t.message===e.message;case"RegExp":if(t.source!==e.source||t.global!==e.global||t.ignoreCase!==e.ignoreCase||t.multiline!==e.multiline||t.sticky!==e.sticky||t.unicode!==e.unicode)return!1}for(var u=r.length-1;u>=0;){if(r[u]===t)return n[u]===e;u-=1}switch(c){case"Map":return t.size===e.size&&b(t.entries(),e.entries(),r.concat([t]),n.concat([e]));case"Set":return t.size===e.size&&b(t.values(),e.values(),r.concat([t]),n.concat([e]));case"Arguments":case"Array":case"Object":case"Boolean":case"Number":case"String":case"Date":case"Error":case"RegExp":case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float32Array":case"Float64Array":case"ArrayBuffer":break;default:return!1}var l=f(t);if(l.length!==f(e).length)return!1;var h=r.concat([t]),d=n.concat([e]);for(u=l.length-1;u>=0;){var p=l[u];if(!s(p,e)||!g(e[p],t[p],h,d))return!1;u-=1}return!0}const y=r((function(t,e){return g(t,e,[],[])}));var S=function(t){return(t<10?"0":"")+t};Date.prototype.toISOString;function _(t){return"[object Object]"===Object.prototype.toString.call(t)}const v=Number.isInteger||function(t){return(t|0)===t};function A(t){return"[object String]"===Object.prototype.toString.call(t)}const E=r((function(t,e){var r=t<0?e.length+t:t;return A(e)?e.charAt(r):e[r]}));function I(n){return function a(i,s,o){switch(arguments.length){case 0:return a;case 1:return t(i)?a:r((function(t,e){return n(i,t,e)}));case 2:return t(i)&&t(s)?a:t(i)?r((function(t,e){return n(t,s,e)})):t(s)?r((function(t,e){return n(i,t,e)})):e((function(t){return n(i,s,t)}));default:return t(i)&&t(s)&&t(o)?a:t(i)&&t(s)?r((function(t,e){return n(t,e,o)})):t(i)&&t(o)?r((function(t,e){return n(t,s,e)})):t(s)&&t(o)?r((function(t,e){return n(i,t,e)})):t(i)?e((function(t){return n(t,s,o)})):t(s)?e((function(t){return n(i,t,o)})):t(o)?e((function(t){return n(i,s,t)})):n(i,s,o)}}}"undefined"!=typeof Symbol&&Symbol.iterator;const T=E(-1);var j=e((function(t){return null!=t&&"function"==typeof t["fantasy-land/empty"]?t["fantasy-land/empty"]():null!=t&&null!=t.constructor&&"function"==typeof t.constructor["fantasy-land/empty"]?t.constructor["fantasy-land/empty"]():null!=t&&"function"==typeof t.empty?t.empty():null!=t&&null!=t.constructor&&"function"==typeof t.constructor.empty?t.constructor.empty():n(t)?[]:A(t)?"":_(t)?{}:u(t)?function(){return arguments}():function(t){var e=Object.prototype.toString.call(t);return"[object Uint8ClampedArray]"===e||"[object Int8Array]"===e||"[object Uint8Array]"===e||"[object Int16Array]"===e||"[object Uint16Array]"===e||"[object Int32Array]"===e||"[object Uint32Array]"===e||"[object Float32Array]"===e||"[object Float64Array]"===e||"[object BigInt64Array]"===e||"[object BigUint64Array]"===e}(t)?t.constructor.from(""):void 0}));const D=j;const L=e((function(t){return null==t}));const F=r((function(t,e){return!L(e)&&t in e}));"function"==typeof Object.assign&&Object.assign;const P=r((function(t,e){return e instanceof t||null!=e&&(e.constructor===t||"Object"===t.name&&"object"==typeof e)}));const U=e((function(t){return null!=t&&y(t,D(t))}));const C=r((function(t,e){return t.map((function(t){for(var r,n=e,a=0;a<t.length;){if(null==n)return;r=t[a],n=v(r)?E(r,n):n[r],a+=1}return n}))}));const O=r((function(t,e){return C([t],e)[0]}));const w=r((function(t,e){return null==e||e!=e?t:e}));const M=I((function(t,e,r){return w(t,O(e,r))}));const R=I((function(t,e,r){return r.replace(t,e)}));var B="\t\n\v\f\r                　\u2028\u2029\ufeff";String.prototype.trim;const q=t=>t.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),N=t=>t.replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&#0?39;/g,"'").replace(/&quot;/g,'"').replace(/&amp;/g,"&");function z(t,...e){if("string"==typeof t)return q(t);let r=t[0];for(const[n,a]of e.entries())r=r+q(String(a))+t[n+1];return r}function H(t,...e){if("string"==typeof t)return N(t);let r=t[0];for(const[n,a]of e.entries())r=r+N(String(a))+t[n+1];return r}class $ extends HTMLElement{static get observedAttributes(){return["data-content","data-source-url","data-globals"]}constructor(){super(),this.template="",this.partials={},this.specs={},this.createdItems=[],this.sourceUrlFetchSent=!1,this.sourceUrlDataReceived=!1,this.pagination=null,this.apiReady=!1,this.shouldLazyLoad=!1,this.speciallyTreatedBuilderiusTags=[],this.dataContent=[],this.dataItemtag=null,this.dataSelector=null,this.dataItemSample=null,this.dataClearIdAttr=!1,this.dataSourceUrl="",this.dataSubscribeFormSelector="",this.dataSubscribeFormEvent="",this.lastTimeData=null,this.dataSubscribeDataPath=null,this.onReadyCb=()=>{$.isApiReady()&&(($.isBuilderMode()||!$.isBuilderMode()&&U(this.template))&&this._setTemplates(),this._subscribeToForm(),$.isBuilderMode()?setTimeout((()=>{this._subscribeToPagination()}),150):this._subscribeToPagination(),this._initiateScript())},document.addEventListener("builderius.frontend.api.ready",(()=>{this.onReadyCb()}),!1)}connectedCallback(){$.isBuilderMode()&&this.onReadyCb()}disconnectedCallback(){this._unsubscribeFromForm(),this._unsubscribeFromPagination(),document.removeEventListener("builderius.frontend.api.ready",(()=>{}),!1)}attributeChangedCallback(t){this._upgradeProperty(t)}_upgradeProperty(t){const e=this._camalize(t);if(F(e,this)){let t=this[e];delete this[e],this[e]=t}}_fromDataset(t,e=null){const r=L(e)?{...this.dataset}:{...e.dataset};return L(r[t])?r[t]:H(r[t])}_inDataset(t,e=null){return t in(L(e)?{...this.dataset}:{...e.dataset})}set dataContent(t){$.isApiReady()&&this._initiateScript()}get dataContent(){const t=this._fromDataset("content");return this._parseJson(t)}set dataGlobals(t){$.isApiReady()&&this._initiateScript()}get dataGlobals(){const t=this._fromDataset("globals");return this._parseJson(t)}set dataItemtag(t){}get dataItemtag(){return this._fromDataset("itemtag")}set dataSelector(t){}get dataSelector(){return this._fromDataset("selector")}set dataItemSample(t){}get dataItemSample(){const t=this._fromDataset("itemSample");return this._parseJson(t)}set dataClearIdAttr(t){}get dataClearIdAttr(){return this._fromDataset("clearIdAttr")}set dataSourceUrl(t){this.isValidURL(t)&&$.isApiReady()&&!this.sourceUrlFetchSent&&!this.sourceUrlDataReceived?(this.sourceUrlFetchSent=!0,this._getDataFromUrl()):this.isValidURL(t)&&!$.isApiReady()&&setTimeout((()=>{this.sourceUrlFetchSent||this._getDataFromUrl()}),1500)}get dataSourceUrl(){return this._fromDataset("sourceUrl")}_parseJson(t){let e={};if(P(Array,t))e=t.map((t=>this._parseJson(t)));else if(P(Object,t))for(let r in t)e[r]=this._parseJson(t[r]);else P(String,t)?(t=$.fromJson(t),e=P(Object,t)?this._parseJson(t):t):e=t;return e}isValidURL(t){return!!new RegExp("^(https?:\\/\\/)?((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|((\\d{1,3}\\.){3}\\d{1,3}))(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*(\\?[;&a-z\\d%_.~+=-]*)?(\\#[-a-z\\d_]*)?$","i").test(t)}_setTemplates(){const t=this.querySelectorAll(":scope > template"),e=document.createElement("template");e.classList.add("uniParentTmpl"),[...t].length&&[...t].forEach((t=>{e.appendChild(t.cloneNode(!0))})),!$.isBuilderMode()&&[...t].length>0&&(this.innerHTML="");let r={};const n=this._traverseTmpl(e,r);r=Object.keys(r).reduce(((t,e)=>(P(Array,r[e])?t[e]=r[e].join(""):t[e]=r[e],t)),{}),this.partials=r,this.template=H(n);const a=new RegExp(/(data-expression+(-+[a-z]+)*="{{(.*?)}}"|data-expression+(-+[a-z]+)*="{{{(.*?)}}}")/g);U(this.partials)||Object.keys(this.partials).map((t=>{const e=this.partials[t].match(a);L(e)||e.map((e=>{let r=e.match(/[^{]{{[^{].*?[^}]}}[^}]|[^{]{{{[^{].*?[^}]}}}[^}]/);L(r)||(r=r[0],"{"!==r.substring(0,1)&&(r=r.slice(1)),"}"!==r.substring(0,-1)&&(r=r.slice(0,-1)),this.partials[t]=R(e,H(r),this.partials[t]))}))}));const i=this.template.match(a);L(i)||i.map((t=>{let e=t.match(/[^{]{{[^{].*?[^}]}}[^}]|[^{]{{{[^{].*?[^}]}}}[^}]/);L(e)||(e=e[0],"{"!==e.substring(0,1)&&(e=e.slice(1)),"}"!==e.substring(0,-1)&&(e=e.slice(0,-1)),this.template=R(t,H(e),this.template))}))}_uniqid(){return"e"+Math.random().toString(16).substring(2,8)}_traverseTmpl(t,e){const r=new RegExp('<[a-zA-Z]+[a-zA-Z-_:0-9]*( [a-zA-Z-_:0-9]+=".+")*\\/? *>'),{nodeType:n,nodeName:a}=t,{section:i,partial:s,partialName:o}={...t.dataset},{when:c=i,if:u=s,ifName:l=o}={...t.dataset},{source:h=c,condition:d=u,recursiveName:p=l}={...t.dataset};let f=[],m=null,b=null,g="";if(!L(t.hasAttributes)&&t.hasAttributes())for(const e of t.attributes)t.setAttribute(e.name,z(H(e.value)));if(1===n){[this.nodeName,"TEMPLATE"].includes(a)||(b=t.cloneNode(!0));let n=[];if(n="TEMPLATE"===a?U([...t.children])&&!L(t.content)?[...t.content.childNodes]:[...t.children]:[...t.childNodes],this.nodeName===a&&this.isSameNode(t)){const e=t.getAttribute("data-content");L(e)||(m=[...e].filter((t=>!y(t,"{")&&!y(t,"}"))).join(""),f.push(`{{> ${m}}}`))}else if("TEMPLATE"===a&&"BUILDERIUS-DYNAMIC-TABLE"!==t.nodeName)t.classList.contains("uniParentTmpl")?f.push("{{#.}}"):L(d)&&L(p)?L(h)||f.push(`{{#${h}}}`):(m=L(p)?this._uniqid():p,L(d)?f.push(`{{> ${m}}}`):f.push(`{{> ${d} ? "${m}" : ""}}`));else if(this.speciallyTreatedBuilderiusTags.includes(a)&&!L(b)){const t=b.innerHTML;b.innerHTML="";const e=b.outerHTML.match(r);g=L(e)||U(e)?"":e[0],f.push(g),f.push("{{=<%% %%>=}}"),f.push(t),n=[]}else if(U(n)||L(n)||L(b))f.push(t.outerHTML);else{const t=b.getAttribute("is");if(!L(t)&&t.match("builderius"))for(const t of b.attributes)if(!["data-content","data-globals","data-tab","data-tab-panel"].includes(t.name)){const e=t.value.match(/{{.*?}}/);if(!L(e)){const e=this._uniqid();this.specs[e]=t.value,b.setAttribute(t.name,`{{${e}}}`)}}b.innerHTML="";const e=b.outerHTML.match(r);g=L(e)||U(e)?"":e[0],f.push(g)}if(n.reduce(((t,r)=>{let n=this._traverseTmpl(r,e);L(d)||L(h)||(n=`{{#${h}}}${n}{{/${h}}}`),L(m)?f.push(n):(L(e[m])&&(e[m]=[]),e[m].push(n))}),{}),"TEMPLATE"===a)t.classList.contains("uniParentTmpl")?f.push("{{/.}}"):!L(h)&&L(d)&&f.push(`{{/${h}}}`);else if(this.speciallyTreatedBuilderiusTags.includes(a)&&!L(b)){f.push("<%%={{ }}=%%>"),b.innerHTML="";const t=T(b.outerHTML.split(g).filter((t=>t)));f.push(t)}else if(!U(n)&&!L(n)&&!L(b)){b.innerHTML="";const t=T(b.outerHTML.split(g).filter((t=>t)));f.push(t)}}else 3===n&&f.push(t.nodeValue);return f.join("")}_getFormEvent(){const t=this._fromDataset("subscribeFormEvent");return!L(t)&&["oninput","onsubmit","onsuccess","onfail","ondisable"].includes(this.dataSubscribeFormEvent)?t:"oninput"}_subscribeToForm(){if(this.dataSubscribeFormSelector=this._fromDataset("subscribeFormSelector"),this.dataSubscribeFormEvent=this._getFormEvent(),this.dataSubscribeDataPath=this._fromDataset("subscribeDataPath"),this.dataSubscribeFormSelector&&this.dataSubscribeFormEvent){const t=document.querySelector(this.dataSubscribeFormSelector);t&&(t.addEventListener(`${this.dataSubscribeFormEvent}`,(t=>{const e=L(this.dataSubscribeDataPath)?t.detail.data:M({},this.dataSubscribeDataPath.split("."),t.detail.data);y(JSON.stringify(e),this.lastTimeData)?this._dispatchEvent("equal-data",{el:this}):(this.lastTimeData=JSON.stringify(e),this.setAttribute("data-content",JSON.stringify(e)))})),t.addEventListener("set-elements",(()=>{this._initiateScript()}),{once:!0}))}}_subscribeToPagination(){this.dataSubscribePaginationSelector=this._fromDataset("subscribePaginationSelector");const t=document.querySelector(this.dataSubscribePaginationSelector);(L(this.pagination)&&t||t&&!t.isSameNode(this.pagination))&&(this.pagination=t,this.pagination.addEventListener("change",(()=>{this._initiateScript()})))}_unsubscribeFromForm(){if(this.dataSubscribeFormSelector=this._fromDataset("subscribeFormSelector"),this.dataSubscribeFormEvent=this._fromDataset("subscribeFormEvent"),this.dataSubscribeFormSelector&&this.dataSubscribeFormEvent){const t=document.querySelector(this.dataSubscribeFormSelector);t&&t.removeEventListener(`${this.dataSubscribeFormEvent}`,(()=>{}))}}_unsubscribeFromPagination(){this.pagination&&this.pagination.removeEventListener("change",(()=>{this._initiateScript()}))}_getDataFromUrl(){try{fetch(this.dataSourceUrl).then((t=>t.json())).then((t=>{this.sourceUrlDataContent=t,this.sourceUrlDataReceived=!0,this._initiateScript()}))}catch(t){console.log("Builderius @ Error in response from the source URL",t),console.error(t)}}_getProperDataContent(){return this.sourceUrlDataReceived?this.sourceUrlDataContent:this.dataContent}_initiateScript(){try{if(U(this.template)&&(this._setTemplates(),U(this.template)))throw new Error("Builderius: no template yet");if(!U(this.dataSourceUrl)&&!L(this.dataSourceUrl)&&!this.isValidURL(this.dataSourceUrl))throw new Error("Builderius: invalid source url");const t=this._getProperDataContent();this.pagination&&!L(this.pagination.setTotalItems)&&P(Array,t)&&(this.pagination.setTotalItems(t.length),this.pagination.collRef=this);const e=this._render();if(!L(e))throw new Error(e);this._dispatchEvent("ready",{el:this})}catch(t){return t}}_merge(t,e){return P(Array,t)?t.map((t=>P(String,t)?t:{...t,...e})):{...t,...e}}_render(){try{const t=this._getProperDataContent();if(L(t))this._removeItems();else{const e=M(null,["Builderius","API","helpers","mustache"],window);let r=this._getItemsPerPage();if(!L(e)){r=this._merge(r,this.specs);const n=e.render(this.template,r,this.partials,{globals:this.dataGlobals});this._appendHtml(n),this._dispatchEvent("rendered",{el:this,content:t})}}}catch(t){return t}}_appendHtml(t){const e=this._getProperDataContent();let r=this;const n=L(this.dataItemtag)?"div":this.dataItemtag;if(!L(this.dataSelector)){const t=document.querySelector(this.dataSelector);L(t)||(r=t)}let a=document.createElement(n);a.insertAdjacentHTML("afterbegin",t),a=this._clearItem(a),this._removeItems(),L(this.dataItemtag)?[...a.children].forEach((t=>{this._addItem(t),r.appendChild(t)})):(this._addItem(a),r.appendChild(a)),this._dispatchEvent("appended-html",{el:this,content:e})}_clearItem(t){const e=["data-uni-node","data-uni-name","data-uni-label","data-uni-parents"];if(this.dataClearIdAttr&&e.push("id"),$.isBuilderMode()){const e=t.getAttribute("data-uni-node");t.setAttribute("data-uni-origin-mod",e);const r=t.getAttribute("data-uni-label");t.setAttribute("data-uni-origin-label",r)}if(e.forEach((e=>t.removeAttribute(e))),[...t.classList].forEach((e=>{L(e.match(/^uni(?!(-node|-[A-Z]))/))&&L(e.match(/builderius/))||t.classList.remove(e)})),U(t.classList)&&t.removeAttribute("class"),!L(t.hasAttributes)&&t.hasAttributes())for(const e of t.attributes)L(e.value)||t.setAttribute(e.name,H(e.value));const r=[...t.children];return U(r)||r.map((e=>{const r=this._clearItem(e);t.replaceChild(r,e)})),t}_addItem(t){this.createdItems.push(t)}_removeItems(){this.createdItems.map((t=>t.remove())),this.createdItems=[]}_getItemsPerPage(){const t=this._getProperDataContent();if(this.pagination&&!L(this.pagination.getData)&&P(Array,t)){const{perPage:e,current:r}=this.pagination.getData();if(0<r&&t.length>e){const n=(r-1)*e,a=t.slice(n,n+e);return U(a)?t:a}return t}return t}_camalize(t){return t.toLowerCase().replace(/[^a-zA-Z0-9]+(.)/g,((t,e)=>e.toUpperCase()))}_dispatchEvent(t,e=null){const r={bubbles:!1,cancelable:!0,detail:e},n=new CustomEvent(t,r),a=new CustomEvent(`builderius-collection-${t}`,r);this.dispatchEvent(n),window.dispatchEvent(a)}reInit(){$.isBuilderMode()&&(this.template="",this.partials={}),this._initiateScript()}testComponent(){return this.template="",this.partials={},this._initiateScript()}static fromJson(t){let e={};if(P(String,t))try{e=JSON.parse(H(t))}catch(e){return t}return e}static isApiReady(){const t=M(null,["Builderius","API"],window);return!L(t)}static isBuilderMode(){return!1!==M(!1,["Builderius","API","registerStore"],window)}}customElements.define("builderius-collection",$)})();